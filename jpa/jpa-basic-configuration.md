# JPA 기본 설정

> 김영한 님의 **자바 ORM 표준 JPA 프로그래밍**을 읽고 인상적인 파트를 정리한 내용

## persistence.xml 설정
책에서 이야기하는 `resources/META-INF/persistence.xml`은 처음 보는 파일명이었지만, 
파일 내부 설정은 어디선가 분명 본적이 있었다.

무엇인고 하니 Spring-boot profile 설정 파일(`.yml`)에 포함시키던 내용이었다.
둘의 차이는 없고, Spring-boot가 `.yml` 파일 설정을 지원해주기 때문에 그렇게 사용하는 거였다!

### JPA 표준 설정, Hibernate 설정
`javax.persistence.xxx.xxx` 로 이루어진 설정들은 JPA 표준 속성으로, 특정 구현체에 종속되지 않는다.
`hibernate.xxx` 로 이루어진 설정들은 Hibernate 만의 전용 속성이다.
특히 `hibernate.dialect` (방언 설정)에서 많이 보았을 것이다.

### 데이터베이스 방언
`hibernate.dialect`는 단순히 SQL 로그를 편하게 보는 설정이 아니고, SQL 표준을 지키지 않은 데이터베이스들을 
관리하기 위해 하이버네이트가 지원하는 번역 기능이다. 덕분에 애플리케이션 코드 변경 없이 
데이터베이스 방언 변경만으로 쉽게 데이터베이스를 교체 할 수 있다.

<br>

## 영속성 유닛, 엔티티 매니저 팩토리, 엔티티 매니저
### 영속성 유닛
JPA 설정은 영속성 유닛(persistence-unit) 이라는 것부터 시작하는데, 
일반적으로 연결 할 데이터베이스당 하나의 영속성 유닛을 등록한다고 한다.
영속성 유닛에는 JDBC 드라이버, 데이터베이스 접속 아이디, 비밀번호, URL 등등의 정보를 포함시킨다. (Datasource)
그리고 이 영속성 유닛을 통해서 엔티티 매니저 팩토리를 생성할 수 있다.

### 엔티티 매니저 팩토리
엔티티 매니저 팩토리는 영속성 유닛을 통해 생성된다. `persistence.xml`에 
영속성 유닛 설정 정보를 읽어서 JPA를 동작시키기 위한 기반 객체를 만들고, 
JPA 구현체에 따라 데이터베이스 커넥션 풀을 생성하기도 한다.

때문에 엔티티 매니저 팩토리는 생성 비용이 굉장히 크므로, 애플리케이션 전체에서 딱 1번만
생성하고 공유해서 사용해야 한다.

## 엔티티 매니저
엔티티 매니저는 엔티티 매니저 팩토리를 통해 생성된다. JPA의 기능 대부분을 엔티티 매니저가 제공한다.
엔티티 매니저는 내부에 데이터소스(데이터베이스 커넥션)을 유지하면서 데이터베이스와 통신한다. (우리가 쉽게 사용하는 `@Repository`가 엔티티 매니저를 의미하는 듯)

엔티티 매니저는 데이트베이스 커넥션과 밀접한 관계가 있으므로 스레드 간 공유하거나 재사용 하면 안 된다!!

<br>

## JPQL
JPA는 SQL을 추상화한 JPQL이라는 객체지향 쿼리를 제공한다.
SQL와 JPQL의 차이는 아래와 같다.

- SQL은 데이터베이스 테이블을 대상으로 쿼리한다.
- JPQL은 엔티티 객체를 대상으로 쿼리한다. 클래스와 필드를 대상으로만 쿼리하고, 데이터베이스 테이블에 대해서는 전혀 알지 못한다.
